<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zworks.pdsys.mappers.OrderDetailMapper">
	<resultMap id="unitResultMap" type="unitModel" >  
        <id column="unit_id" property="id"/>  
        <result column="unit_name" property="name"/>  
    </resultMap>
	<resultMap id="supplierResultMap" type="supplierModel" >  
        <id column="supplier_id" property="id" />  
        <result column="supplier_name" property="name"/>  
    </resultMap>
    <resultMap id="bomResultMap" type="BOMModel" >  
        <id column="bom_id" property="id" />  
        <result column="bom_pn" property="pn"/>  
        <result column="bom_name" property="name"/>  
        <result column="bom_type" property="type"/>  
        <association property="unit" resultMap="unitResultMap"/>
        <association property="supplier" resultMap="supplierResultMap"/>
    </resultMap>
	<resultMap id="orderDetailMapper" type="orderPnModel" >  
        <id column="order_pn_id" property="id" />  
        <result column="order_pn_num" property="num" />  
        <result column="order_pn_reject_ratio" property="rejectRatio" />  
        <association property="pn" resultMap="pnResultMap"/>
    </resultMap>
    
	<select id="queryList" parameterType="com.zworks.pdsys.mappers.OrderMapper" resultMap="orderDetailMapper">
		select order_pn.c_id as order_pn_id,
			   pn.c_pn as od_pn,
			   pn.c_name as od_pn_name,
		       pn_cls.c_name as od_pn_cls_name,
		       order_pn.c_num as order_pn_num,
		       pn_ut.c_name as pn_ut_name,
		       bom.c_name as bom_name,
		       bom.c_type as bom_type,
		       pn_bom_relation.c_use_num as bom_relation_num,
		       bom_ut.c_name as bom_ut_name,
			   wh_pn. c_type as wh_pn_type,
			   wh_pn. c_num as wh_pn_num,
			   order_pn.c_reject_ratio as order_pn_reject_ratio
				 
		from order_pn_tbl as order_pn 
		left join pn_tbl as pn on order_pn.c_pn_id = pn.c_id 
		left join pn_cls_tbl as pn_cls on order_pn.c_pn_cls_id = pn_cls.c_id 
		left join unit_tbl as pn_ut on pn.c_unit_id = pn_ut.c_id 
		left join pn_bom_relation_tbl as pn_bom_relation on pn_bom_relation.c_pn_id = pn_cls.c_id 
		left join bom_tbl as bom on pn_bom_relation.c_bom_id = bom.c_id 
		left join unit_tbl as bom_ut on bom.c_unit_id = bom_ut.c_id 
		left join warehouse_pn_tbl as wh_pn on wh_pn.c_order_pn_id = order_pn.c_id 
		<where>
			<if test="id != null and id.trim() != ''">
				and order_pn.c_order_id = #{id}
			</if>
		</where>
	</select>
</mapper>